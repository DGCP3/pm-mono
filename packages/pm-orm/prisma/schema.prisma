// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// generator zod {
//   provider              = "zod-prisma"
//   output                = "../src/schema" // (default) the directory where generated zod schemas will be saved
//   relationModel         = false // (default) Create and export both plain and related models.
//   isGenerateSelect      = true
//   // relationModel         = "default" // Do not export model without relations.
//   // relationModel         = false // Do not generate related model
//   modelCase             = "SnakeCase" // (default) Output models using pascal case (ex. UserModel, PostModel)
//   // modelCase             = "camelCase" // Output models using camel case (ex. userModel, postModel)
//   modelSuffix           = "Schema" // (default) Suffix to apply to your prisma models when naming Zod schemas
//   // useDecimalJs          = false // (default) represent the prisma Decimal type using as a JS number
//   useDecimalJs          = true // represent the prisma Decimal type using Decimal.js (as Prisma does)
//   // (default) will import the referenced file in generated schemas to be used via imports.someExportedVariable
//   // https://www.prisma.io/docs/concepts/components/prisma-client/working-with-fields/working-with-json-fields#filtering-by-null-values
//   // prismaJsonNullability = true // (default) uses prisma's scheme for JSON field nullability
//   prismaJsonNullability = true // allows null assignment to optional JSON fields
// }
// generator zod {
//   provider          = "prisma-zod-generator"
//   output            = "../schema"
//   isGenerateSelect  = true
//   isGenerateInclude = true
// }

model User_Account {
  id             String           @id @default(uuid())
  email          String           @unique
  password       String ///@zod.min(8).max(20).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])/, 'Password must contain at least one lowercase letter, one uppercase letter, one number, and one special character')
  username       String ///@zod.min(3).max(20).regex(/^[a-zA-Z0-9]+$/, 'Username must contain only letters and numbers')
  authToken      String?
  Project        Project[]
  created        DateTime         @default(now()) /// @zod.optional()
  updated        DateTime         @updatedAt /// @zod.optional()
  Task_List      Task_List[]
  Project_Member Project_Member[]
}

// Project
model Project {
  id             String           @id @default(uuid()) /// @zod.uuid().optional()
  title          String
  description    String?
  ownerId        String
  owner          User_Account     @relation(fields: [ownerId], references: [id])
  closed         Boolean          @default(false) /// @zod.default(false)
  favorite       Boolean          @default(false) /// @zod.default(false)
  created        DateTime         @default(now()) /// @zod.optional()
  updated        DateTime         @updatedAt /// @zod.optional()
  list           List[]
  Project_Member Project_Member[]
}

model Project_Member {
  id        String       @id @default(uuid()) /// @zod.uuid()
  projectId String
  userId    String
  Project   Project      @relation(fields: [projectId], references: [id])
  User      User_Account @relation(fields: [userId], references: [id])
}

model List {
  id        String  @id @default(uuid()) /// @zod.uuid()
  title     String
  projectId String
  Project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  Card      Card[]
}

model Card {
  id          String         @id @default(uuid()) /// @zod.uuid()
  title       String         @default("Untitled Card")
  description String?
  due_date    DateTime?
  avatar      String?
  list_id     String
  List        List           @relation(fields: [list_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  priority    Priority?
  status      Status?
  Comment     Card_Comment[]
  Task_List   Task_List[]
  created     DateTime       @default(now()) /// @zod.optional()
  updated     DateTime       @updatedAt /// @zod.optional()
}

model Card_Comment {
  id      String   @id @default(uuid()) /// @zod.uuid()
  comment String
  cardId  String
  card    Card     @relation(fields: [cardId], references: [id])
  created DateTime @default(now())
  updated DateTime @updatedAt
}

model Task_List {
  id            String        @id @default(uuid()) /// @zod.uuid().optional()
  title         String
  cardId        String
  card          Card          @relation(fields: [cardId], references: [id])
  Task          Task[]
  userAccountId String?
  UserAccount   User_Account? @relation(fields: [userAccountId], references: [id])
  created       DateTime      @default(now())
  updated       DateTime      @updatedAt
}

model Task {
  id              String            @id @default(uuid()) /// @zod.uuid().optional()
  title           String
  done            Boolean           @default(false)
  assigned_to     String?
  task_listId     String
  Task_List       Task_List         @relation(fields: [task_listId], references: [id])
  created         DateTime          @default(now())
  updated         DateTime          @updatedAt
  Task_Assignment Task_Assignment[]
}

model Task_Assignment {
  id            String   @id @default(uuid()) /// @zod.uuid().optional()
  task_id_fk    String
  Project_Tasks Task     @relation(fields: [task_id_fk], references: [id])
  assigned_to   String
  created       DateTime @default(now())
  updated       DateTime @updatedAt
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum Status {
  TODO
  IN_PROGRESS
  DONE
  IN_REVIEW
  APPROVED
}
